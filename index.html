<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Hora Extra</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: white;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
      max-width: 600px;
      width: 100%;
    }

    .header { text-align: center; margin-bottom: 32px; }

    .header h1 {
      color: #1a202c;
      font-size: 30px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .header p { color: #718096; font-size: 13px; }

    .escala-selector {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }

    .escala-option {
      background: #f7fafc;
      border: 3px solid #e2e8f0;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s;
      user-select: none;
    }

    .escala-option:hover { border-color: #667eea; background: #edf2f7; }
    .escala-option.selected {
      border-color: #667eea;
      background: linear-gradient(135deg, #ebf4ff 0%, #e0e7ff 100%);
      box-shadow: 0 4px 12px rgba(102,126,234,0.18);
    }

    .escala-option input[type="radio"] { display:none; }

    .escala-time {
      font-size: 28px;
      font-weight: 800;
      color: #2d3748;
      margin-bottom: 6px;
    }
    .escala-option.selected .escala-time { color: #667eea; }

    .escala-label { font-size: 12px; color:#718096; font-weight:600; }

    .input-section {
      background: #f7fafc;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 18px;
    }

    .input-group { margin-bottom: 16px; }
    .input-group:last-child { margin-bottom: 0; }

    label {
      display:block;
      font-size: 13px;
      font-weight: 700;
      color: #4a5568;
      margin-bottom: 8px;
    }

    input[type="time"] {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      color: #2d3748;
      background: #fff;
      transition: all 0.2s;
    }

    input[type="time"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.12);
    }

    .calculate-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.25s;
      box-shadow: 0 4px 12px rgba(102,126,234,0.4);
    }
    .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(102,126,234,0.5); }
    .calculate-btn:active { transform: translateY(0); }

    .results { margin-top: 26px; display:none; animation: up 0.35s ease-out; }
    .results.show { display:block; }

    @keyframes up {
      from { opacity:0; transform: translateY(18px); }
      to { opacity:1; transform: translateY(0); }
    }

    .result-card {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 16px;
      padding: 18px;
      margin-bottom: 14px;
      border: 2px solid #e2e8f0;
    }

    .result-row {
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: 10px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    .result-row:last-child { border-bottom:none; }

    .result-label { font-size: 13px; color:#718096; font-weight:600; }
    .result-value { font-size: 17px; color:#2d3748; font-weight:800; }

    .note {
      margin-top: 10px;
      font-size: 12px;
      color: #718096;
      text-align: center;
    }

    .alert-tac {
      background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
      border: 2px solid #fc8181;
      border-radius: 16px;
      padding: 18px;
      text-align:center;
      margin-top: 14px;
    }
    .alert-tac .icon { font-size: 44px; margin-bottom: 8px; }
    .alert-tac .title { font-size: 18px; font-weight: 900; color:#c53030; margin-bottom: 6px; }
    .alert-tac .message { font-size: 13px; color:#742a2a; }
    .alert-tac .overtime { font-size: 22px; font-weight: 900; color:#c53030; margin-top: 10px; }

    .success-card {
      background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
      border: 2px solid #68d391;
      border-radius: 16px;
      padding: 18px;
      text-align:center;
      margin-top: 14px;
    }
    .success-card .icon { font-size: 44px; margin-bottom: 8px; }
    .success-card .title { font-size: 18px; font-weight: 900; color:#2f855a; margin-bottom: 6px; }
    .success-card .message { font-size: 13px; color:#22543d; }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>‚è∞ Calculadora de Hora Extra</h1>
      <p>Regras Senior: hora certa + hora noturna reduzida (sem proporcional)</p>
    </div>

    <div class="escala-selector">
      <label class="escala-option selected">
        <input type="radio" name="escala" value="08:48" checked onchange="updateEscala()">
        <div class="escala-time">08:48</div>
        <div class="escala-label">Dia: intervalo 01:15</div>
      </label>
      <label class="escala-option">
        <input type="radio" name="escala" value="07:20" onchange="updateEscala()">
        <div class="escala-time">07:20</div>
        <div class="escala-label">Dia: intervalo 01:00</div>
      </label>
    </div>

    <div class="input-section">
      <div class="input-group">
        <label>üïê Hor√°rio de Entrada</label>
        <input type="time" id="entrada" value="22:29">
      </div>
      <div class="input-group">
        <label>üïê Hor√°rio de Sa√≠da</label>
        <input type="time" id="saida" value="06:14">
      </div>
    </div>

    <button class="calculate-btn" onclick="calcular()">Calcular Jornada</button>

    <div class="results" id="results">
      <div class="result-card">
        <div class="result-row">
          <span class="result-label">Escala</span>
          <span class="result-value" id="escala-selected">--</span>
        </div>
        <div class="result-row">
          <span class="result-label">Intervalo aplicado</span>
          <span class="result-value" id="intervalo-aplicado">--</span>
        </div>
        <div class="result-row">
          <span class="result-label">Tempo total no local</span>
          <span class="result-value" id="tempo-total">--</span>
        </div>
        <div class="result-row">
          <span class="result-label">Horas Extras (regra toler√¢ncia)</span>
          <span class="result-value" id="horas-extras">--</span>
        </div>
      </div>

      <div id="alert-container"></div>

      <div class="note" id="debug-note"></div>
    </div>
  </div>

<script>
/** ==========================
 *  CONFIG (ajuste se precisar)
 *  ========================== */

// Toler√¢ncia: at√© 10 min n√£o gera extra; 11+ gera
const TOLERANCIA_MIN = 10;

// Hora noturna (Senior / CLT): 22:00‚Äì05:00
const NOTURNO_INICIO = 22 * 60; // 1320
const NOTURNO_FIM    = 5 * 60;  // 300

// Intervalo "hora certa" na MADRUGADA
// Se no Senior o intervalo noturno inicia em outro hor√°rio, altere aqui:
const NIGHT_BREAK_START = "01:00";

// Hora noturna reduzida: 52m30s = 3150s computa como 3600s
const FATOR_NOTURNO_SEG = 3600 / 3150;

/** ==========================
 *  UI helpers
 *  ========================== */
function updateEscala() {
  document.querySelectorAll('.escala-option').forEach(o => o.classList.remove('selected'));
  document.querySelector('input[name="escala"]:checked').parentElement.classList.add('selected');
}

function timeToMinutes(time) {
  const [h, m] = time.split(':').map(Number);
  return h * 60 + m;
}

function minutesToTime(minutes) {
  const hh = Math.floor(Math.abs(minutes) / 60);
  const mm = Math.abs(minutes) % 60;
  return `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
}

function clockToMin(hhmm) {
  const [h, m] = hhmm.split(':').map(Number);
  return h * 60 + m;
}

function addDayIfNeeded(entradaMin, saidaMin) {
  return (entradaMin > saidaMin) ? (saidaMin + 1440) : saidaMin;
}

function overlapMinutes(aStart, aEnd, bStart, bEnd) {
  const s = Math.max(aStart, bStart);
  const e = Math.min(aEnd, bEnd);
  return Math.max(0, e - s);
}

/** ==========================
 *  C√°lculo Night (Senior-like)
 *  - Sem proporcional
 *  - Intervalo hora certa (01:12) na madrugada
 *  - Redu√ß√£o noturna em segundos + truncar
 *  ========================== */
function calcNight(entradaMin, saidaMinCont, intervaloMin) {
  // 1) Conta noturno/diurno (reais, sem intervalo)
  let noturnoReal = 0;
  let diurnoReal  = 0;

  for (let t = entradaMin; t < saidaMinCont; t++) {
    const clock = t % 1440;
    const eNoturno = (clock >= NOTURNO_INICIO) || (clock < NOTURNO_FIM);
    if (eNoturno) noturnoReal++;
    else diurnoReal++;
  }

  // 2) Intervalo "hora certa" (aplica no dia seguinte, pois passou da meia-noite)
  const breakStartClock = clockToMin(NIGHT_BREAK_START);
  const breakStart = breakStartClock + 1440;
  const breakEnd = breakStart + intervaloMin;

  const intervaloAplicado = overlapMinutes(entradaMin, saidaMinCont, breakStart, breakEnd);

  // 3) Desconta intervalo primeiro do NOTURNO (mais fiel para turno noturno)
  let restante = intervaloAplicado;

  const debNot = Math.min(noturnoReal, restante);
  noturnoReal -= debNot;
  restante -= debNot;

  const debDiu = Math.min(diurnoReal, restante);
  diurnoReal -= debDiu;
  restante -= debDiu;

  const noturnoTrabalhado = noturnoReal;
  const diurnoTrabalhado  = diurnoReal;

  // 4) Redu√ß√£o noturna (Senior): calcula em segundos e TRUNCA
  const noturnoCompSeg = (noturnoTrabalhado * 60) * FATOR_NOTURNO_SEG;
  const noturnoComputado = Math.floor(noturnoCompSeg / 60);

  const computadoTotal = noturnoComputado + diurnoTrabalhado;
  const trabalhadoRealTotal = noturnoTrabalhado + diurnoTrabalhado;

  return {
    intervaloAplicado,
    noturnoTrabalhado,
    diurnoTrabalhado,
    noturnoComputado,
    computadoTotal,
    trabalhadoRealTotal
  };
}

// menor tempo no local (min) para atingir jornada base computada (sem extra)
function findIdealNightOnSiteDuration(entradaMin, intervaloMin, jornadaBaseMin) {
  // limites seguros
  let lo = 1;
  let hi = 24 * 60; // 1 dia
  let ans = hi;

  while (lo <= hi) {
    const mid = Math.floor((lo + hi) / 2);
    const saida = entradaMin + mid;
    const r = calcNight(entradaMin, saida, intervaloMin);
    if (r.computadoTotal >= jornadaBaseMin) {
      ans = mid;
      hi = mid - 1;
    } else {
      lo = mid + 1;
    }
  }
  return ans;
}

/** ==========================
 *  Main
 *  ========================== */
function calcular() {
  const entrada = document.getElementById('entrada').value;
  const saida   = document.getElementById('saida').value;
  const escala  = document.querySelector('input[name="escala"]:checked').value;

  if (!entrada || !saida) {
    alert('Por favor, preencha os hor√°rios de entrada e sa√≠da!');
    return;
  }

  const entradaMin = timeToMinutes(entrada);
  const saidaMin   = timeToMinutes(saida);
  const passouMeiaNoite = entradaMin > saidaMin;

  // Bloquear turno de madrugada
  if (passouMeiaNoite) {
    document.getElementById('results').classList.add('show');
    document.getElementById('escala-selected').textContent = '--';
    document.getElementById('intervalo-aplicado').textContent = '--';
    document.getElementById('tempo-total').textContent = '--';
    document.getElementById('horas-extras').textContent = '--';
    document.getElementById('debug-note').textContent = '';
    document.getElementById('alert-container').innerHTML = `
      <div class="alert-tac" style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); border-color: #f59e0b;">
        <div class="icon">üåô</div>
        <div class="title" style="color: #92400e;">Turno de Madrugada Detectado</div>
        <div class="message" style="color: #78350f; font-size: 14px; line-height: 1.6;">
          Esta calculadora √© destinada apenas ao turno diurno.<br><br>
          Para calcular horas extras do turno da madrugada, por favor<br>
          <strong>procure a Administra√ß√£o de Pessoal.</strong>
        </div>
      </div>
    `;
    return;
  }

  // jornada base
  const jornadaBaseMin = (escala === '08:48') ? 528 : 440;

  // intervalo conforme regra
  let intervaloMin;
  if (passouMeiaNoite) {
    intervaloMin = 72; // madrugada SEMPRE 01:12
  } else {
    intervaloMin = (escala === '08:48') ? 75 : 60; // dia
  }

  // tempo total no local (min)
  const saidaMinCont = addDayIfNeeded(entradaMin, saidaMin);
  const tempoTotalMin = saidaMinCont - entradaMin;

  // UI b√°sicos
  document.getElementById('escala-selected').textContent = escala;
  document.getElementById('tempo-total').textContent = minutesToTime(tempoTotalMin);

  const alertContainer = document.getElementById('alert-container');
  alertContainer.innerHTML = '';
  document.getElementById('debug-note').textContent = '';

  // ===== DIURNO (simples) =====
  if (!passouMeiaNoite) {
    // Senior aqui seria por hora certa tamb√©m, mas sem hor√°rio do intervalo informado,
    // usamos o desconto fixo (como voc√™ j√° fazia), pois o turno diurno normalmente cont√©m o intervalo.
    const trabalhadoReal = Math.max(0, tempoTotalMin - intervaloMin);

    // Extra real no rel√≥gio (ap√≥s cumprir jornada real)
    const extraReal = Math.max(0, trabalhadoReal - jornadaBaseMin);
    const faltanteReal = Math.max(0, jornadaBaseMin - trabalhadoReal);

    document.getElementById('intervalo-aplicado').textContent = minutesToTime(intervaloMin);

    if (extraReal > TOLERANCIA_MIN) {
      document.getElementById('horas-extras').textContent = `${minutesToTime(extraReal)} extras`;

      // Limite de 2h extras para 07:20
      if (escala === '07:20' && extraReal > 120) {
        alertContainer.innerHTML = `
          <div class="alert-tac">
            <div class="icon">‚ö†Ô∏è</div>
            <div class="title">TAC / Limite excedido</div>
            <div class="message">Voc√™ ultrapassou o limite de 2 horas extras.</div>
            <div class="overtime">Excedente: ${minutesToTime(extraReal - 120)}</div>
          </div>
        `;
      } else if (escala === '08:48' && trabalhadoReal > 600) {
        alertContainer.innerHTML = `
          <div class="alert-tac">
            <div class="icon">‚ö†Ô∏è</div>
            <div class="title">TAC / Limite excedido</div>
            <div class="message">Voc√™ ultrapassou o limite de 10 horas trabalhadas.</div>
            <div class="overtime">Excedente: ${minutesToTime(trabalhadoReal - 600)}</div>
          </div>
        `;
      } else {
        alertContainer.innerHTML = `
          <div class="success-card">
            <div class="icon">‚úÖ</div>
            <div class="title">Hora Extra</div>
            <div class="message">Hora extra dentro do limite, considerando toler√¢ncia.</div>
          </div>
        `;
      }
    } else if (faltanteReal > TOLERANCIA_MIN) {
      document.getElementById('horas-extras').textContent = `${minutesToTime(faltanteReal)} faltantes`;
      alertContainer.innerHTML = `
        <div class="alert-tac">
          <div class="icon">‚ö†Ô∏è</div>
          <div class="title">Aten√ß√£o</div>
          <div class="message">Voc√™ n√£o completou sua jornada.</div>
          <div class="overtime">${minutesToTime(faltanteReal)} faltantes</div>
        </div>
      `;
    } else {
      document.getElementById('horas-extras').textContent = `Jornada completa (toler√¢ncia)`;
      alertContainer.innerHTML = `
        <div class="success-card">
          <div class="icon">‚úÖ</div>
          <div class="title">Jornada Normal</div>
          <div class="message">Dentro da toler√¢ncia de ${TOLERANCIA_MIN} minutos.</div>
        </div>
      `;
    }

    document.getElementById('results').classList.add('show');
    return;
  }

  // ===== MADRUGADA (Senior-like) =====
  // 1) Resultado real para exibir (com intervalo hora certa e redu√ß√£o truncada)
  const real = calcNight(entradaMin, saidaMinCont, intervaloMin);
  document.getElementById('intervalo-aplicado').textContent = minutesToTime(real.intervaloAplicado);

  // 2) Descobre tempo ideal no local para "bater" a jornada (sem extra)
  const idealOnSite = findIdealNightOnSiteDuration(entradaMin, intervaloMin, jornadaBaseMin);

  // 3) Extra no rel√≥gio (isso evita 01:01 e bate com a simula√ß√£o do Senior)
  const extraRealMin = Math.max(0, tempoTotalMin - idealOnSite);
  const faltanteRealMin = Math.max(0, idealOnSite - tempoTotalMin);

  // TAC (pelo real trabalhado / extra real)
  let tac = false;
  let tacMsg = '';
  let tacExc = 0;

  if (escala === '08:48') {
    // limite: 10h trabalhadas (real, sem intervalo)
    if (real.trabalhadoRealTotal > 600) {
      tac = true;
      tacMsg = 'Voc√™ ultrapassou o limite de 10 horas trabalhadas!';
      tacExc = real.trabalhadoRealTotal - 600;
    }
  } else {
    // 07:20: limite 2h extras (real no rel√≥gio)
    if (extraRealMin > 120) {
      tac = true;
      tacMsg = 'Voc√™ ultrapassou o limite de 2 horas extras!';
      tacExc = extraRealMin - 120;
    }
  }

  // Exibir extras respeitando toler√¢ncia
  if (extraRealMin > TOLERANCIA_MIN) {
    document.getElementById('horas-extras').textContent = `${minutesToTime(extraRealMin)} extras`;

    if (tac) {
      alertContainer.innerHTML = `
        <div class="alert-tac">
          <div class="icon">‚ö†Ô∏è</div>
          <div class="title">TAC / Limite excedido</div>
          <div class="message">${tacMsg}</div>
          <div class="overtime">Excedente: ${minutesToTime(tacExc)}</div>
        </div>
      `;
    } else {
      alertContainer.innerHTML = `
        <div class="success-card">
          <div class="icon">‚úÖ</div>
          <div class="title">Hora Extra</div>
          <div class="message">Hora extra dentro do limite, considerando toler√¢ncia.</div>
        </div>
      `;
    }
  } else if (faltanteRealMin > TOLERANCIA_MIN) {
    document.getElementById('horas-extras').textContent = `${minutesToTime(faltanteRealMin)} faltantes`;
    alertContainer.innerHTML = `
      <div class="alert-tac">
        <div class="icon">‚ö†Ô∏è</div>
        <div class="title">Aten√ß√£o</div>
        <div class="message">Voc√™ n√£o completou sua jornada.</div>
        <div class="overtime">${minutesToTime(faltanteRealMin)} faltantes</div>
      </div>
    `;
  } else {
    document.getElementById('horas-extras').textContent = `Jornada completa (toler√¢ncia)`;
    alertContainer.innerHTML = `
      <div class="success-card">
        <div class="icon">‚úÖ</div>
        <div class="title">Jornada Normal</div>
        <div class="message">Dentro da toler√¢ncia de ${TOLERANCIA_MIN} minutos.</div>
      </div>
    `;
  }

  // Debug opcional (para voc√™ conferir com o Senior)
  const bonusReducao = real.noturnoComputado - real.noturnoTrabalhado;
  document.getElementById('debug-note').textContent =
    `Madrugada (Senior-like): Noturno trabalhado ${minutesToTime(real.noturnoTrabalhado)}, diurno trabalhado ${minutesToTime(real.diurnoTrabalhado)} | Redu√ß√£o noturna +${minutesToTime(bonusReducao)} | Ideal (sem extra) no local: ${minutesToTime(idealOnSite)}.`;

  document.getElementById('results').classList.add('show');
}

// Enter para calcular
document.querySelectorAll('input[type="time"]').forEach(input => {
  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') calcular();
  });
});
</script>
</body>
</html>
